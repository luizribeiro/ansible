- name: Install openssh
  pacman:
    name: openssh
    state: present
- name: Setup sshd_config
  copy:
    src: files/etc/sshd_config
    dest: /etc/ssh/sshd_config
    owner: root
    group: root
    mode: u+rw,g-rwx,o-rwx
    validate: 'sshd -tf %s'
  notify: restart sshd
- name: Allow (limited) SSH traffic from anywhere
  ufw:
    rule: limit
    port: '22'
- name: Allow mosh traffic from anywhere
  ufw:
    rule: allow
    port: 60000:60999
    protocol: udp
- name: sshd is enabled and running
  systemd:
    name: sshd
    enabled: yes
    state: started
